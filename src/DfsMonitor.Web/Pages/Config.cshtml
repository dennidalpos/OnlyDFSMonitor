<html>
<head><title>DFS Monitor Config</title><style>body{font-family:Arial;margin:1.5rem}textarea{width:100%;height:40vh}</style></head>
<body>
<h1>Configuration</h1>
<p>
  <label>Polling seconds <input id="poll" type="number"/></label>
  <label>Timeout seconds <input id="timeout" type="number"/></label>
  <label>Max parallelism <input id="parallel" type="number"/></label>
</p>
<p>
  <label><input id="dfsn" type="checkbox"/> DFS-N</label>
  <label><input id="dfsr" type="checkbox"/> DFS-R</label>
  <label><input id="ev" type="checkbox"/> EventLog</label>
</p>
<p>
  <label>Config UNC <input id="cfgPath" style="width:45rem"/></label><br/>
  <label>Status UNC root <input id="statusPath" style="width:45rem"/></label><br/>
  <label>Local cache root <input id="cachePath" style="width:45rem"/></label>
</p>
<h3>Namespaces (one UNC path per line)</h3>
<textarea id="namespaces"></textarea>
<h3>Raw JSON (advanced)</h3>
<textarea id="raw"></textarea><br/>
<button onclick="save()">Save</button> <button onclick="reloadConfig()">Reload</button> <a href="/">Back</a>

<script>
let current;
async function reloadConfig(){
  const r=await fetch('/api/config');
  current = await r.json();
  document.getElementById('poll').value = current.collection.pollingIntervalSeconds;
  document.getElementById('timeout').value = current.collection.requestTimeoutSeconds;
  document.getElementById('parallel').value = current.collection.maxParallelism;
  document.getElementById('dfsn').checked = current.collectors.dfsNamespace;
  document.getElementById('dfsr').checked = current.collectors.dfsReplication;
  document.getElementById('ev').checked = current.collectors.eventLog;
  document.getElementById('cfgPath').value = current.storage.configUncPath;
  document.getElementById('statusPath').value = current.storage.statusUncRootPath;
  document.getElementById('cachePath').value = current.storage.localCacheRootPath;
  document.getElementById('namespaces').value = (current.namespaces||[]).map(n=>n.path).join('\n');
  document.getElementById('raw').value = JSON.stringify(current,null,2);
}

async function save(){
  const parsed = JSON.parse(document.getElementById('raw').value);
  parsed.collection.pollingIntervalSeconds = Number(document.getElementById('poll').value);
  parsed.collection.requestTimeoutSeconds = Number(document.getElementById('timeout').value);
  parsed.collection.maxParallelism = Number(document.getElementById('parallel').value);
  parsed.collectors.dfsNamespace = document.getElementById('dfsn').checked;
  parsed.collectors.dfsReplication = document.getElementById('dfsr').checked;
  parsed.collectors.eventLog = document.getElementById('ev').checked;
  parsed.storage.configUncPath = document.getElementById('cfgPath').value;
  parsed.storage.statusUncRootPath = document.getElementById('statusPath').value;
  parsed.storage.localCacheRootPath = document.getElementById('cachePath').value;
  parsed.namespaces = document.getElementById('namespaces').value.split('\n').map(x=>x.trim()).filter(Boolean).map((path,ix)=>({id:`ui-${ix}-${Date.now()}`,path,enabled:true}));

  const r = await fetch('/api/config',{method:'PUT',headers:{'content-type':'application/json'},body:JSON.stringify(parsed)});
  alert(r.ok?'Saved':'Save failed');
  if(r.ok) reloadConfig();
}
reloadConfig();
</script>
</body></html>
